# PyInstaller Reverse Engineering Toolkit (PIRET)

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![PyInstaller Support](https://img.shields.io/badge/PyInstaller-2.0%20â€“%206.14.0-informational)](https://github.com/pyinstaller/pyinstaller)
[![Python Versions](https://img.shields.io/badge/Python-3.6%20â€“%203.13+-blue)](https://www.python.org)
[![Build Status](https://img.shields.io/badge/Makefile-Adaptive%20Pipeline-green)](Makefile)

> **PIRET** is a fully automated, adaptive, and robust reverse engineering pipeline for decompiling executables generated by **PyInstaller**. It integrates state-of-the-art extraction and decompilation tools with intelligent fallback strategies to maximize source recoveryâ€”even in the presence of malformed headers, unknown Python versions, or stripped metadata.

---

## ðŸŽ¯ Objectives

This toolkit addresses the following core challenges in PyInstaller binary analysis:

1. **Automatic Python version detection** from embedded metadata.
2. **Robust extraction** of CArchive and PYZ archives, including entry-point identification.
3. **Multi-tool decompilation** with cascading fallbacks:
   - `pycdc` â†’ `uncompyle6` â†’ raw code object extraction â†’ disassembly.
4. **Graceful degradation** when standard decompilers fail (e.g., due to custom builds or obfuscation).
5. **Reproducible, scriptable workflow** via GNU Make, enabling integration into larger forensic or malware analysis pipelines.

---

## ðŸ§  Theoretical Background

### PyInstaller Binary Structure

PyInstaller packages Python applications into standalone executables by:

- Embedding a **CArchive** (custom archive format) containing:
  - Bootloader scripts (e.g., `pyiboot01_bootstrap.pyc`)
  - Entry-point `.pyc` file (e.g., `main.pyc`)
  - Optional **PYZ archive** (compressed, zlib-encoded bundle of `.pyc` files).
- Storing **Python bytecode** in `.pyc` format, prefixed with a **magic number** identifying the Python version.

> âš ï¸ **Key Issue**: The `.pyc` headers inside PyInstaller binaries are **non-standard**â€”they omit the timestamp/size fields and may use internal offsets. Direct decompilation fails without header repair.

### Magic Number Mapping

PyInstaller reports Python versions as **minor-version integers**:

- `36` â†’ Python **3.6**
- `310` â†’ Python **3.10**
- `312` â†’ Python **3.12**

This encoding must be correctly parsed to select compatible decompilers and disassemblers.

---

## ðŸ› ï¸ Methodology

The pipeline executes in **five adaptive stages**:

| Stage                                 | Tool                                                  | Purpose                                                                 |
| ------------------------------------- | ----------------------------------------------------- | ----------------------------------------------------------------------- |
| **1. Dependency Check**         | `make check-deps`                                   | Validates presence of `git`, `cmake`, `g++`, `xxd`              |
| **2. Python Version Detection** | `pyinstxtractor` + user prompt                      | Extracts `Python version: XX` from binary; falls back to manual input |
| **3. Archive Extraction**       | `pyinstxtractor.py`                                 | Repairs `.pyc` headers and unpacks CArchive + PYZ                     |
| **4. Decompilation Cascade**    | `pycdc` â†’ `uncompyle6` â†’ raw marshal extraction | Attempts source recovery with multiple engines                          |
| **5. Disassembly Fallback**     | `pycdas` + version probing                          | Generates human-readable bytecode for manual analysis                   |

> ðŸ” **Fallback Logic**: If all decompilers fail, the toolkit:
>
> 1. Scans the first 32 bytes of the `.pyc` file for a valid `marshal` code object.
> 2. Extracts the raw code object.
> 3. Tries disassembly across Python versions `3.7â€“3.13`.

---

## âœ… Requirements

### System Dependencies

- Linux, macOS, or WSL (Windows native CMD/PowerShell not recommended)
- `bash` (v4+)
- `make`, `git`, `cmake`, `g++`, `xxd`

### Python Environment

- **Host Python**: â‰¥ 3.6 (to run `pyinstxtractor`)
- **Target Python**: Must match the version used to build the executable (auto-detected or user-specified)
- Required packages (installed automatically):
  - `uncompyle6`
  - `xdis`

### External Tools (Auto-Built)

- [`pyinstxtractor`](https://github.com/extremecoders-re/pyinstxtractor) (v6.14.0 compatible)
- [`pycdc`](https://github.com/zrax/pycdc) (C++ decompiler/disassembler)

> âœ… **Supported PyInstaller Versions**:
> `2.0`, `2.1`, `3.0â€“3.6`, `4.0â€“4.10`, `5.0â€“5.13.2`, `6.0.0â€“6.14.0`
> *(All versions tested by upstream `pyinstxtractor`)*

---

## ðŸš€ Usage

### Quick Start

```bash
# Clone this repo
git clone https://github.com/yourname/piret.git
cd piret

# Configure target
cp Makefile Makefile.local
# Edit TARGET_EXE := your_binary.exe

# Run full pipeline
make
```

### Manual Control

```bash
make help                     # Show targets
make detect-python-version    # Force version detection
make extract                  # Extract only
make recover-source           # Decompile only
make clean                    # Remove all artifacts
```

### Output Structure

```
your_binary.exe_extracted/       # Raw extracted files (from pyinstxtractor)
â”œâ”€â”€ your_binary.pyc             # Main entry point
â”œâ”€â”€ PYZ-00.pyz_extracted/       # Unpacked PYZ archive
â”‚   â””â”€â”€ *.pyc
â””â”€â”€ ...

src_recovered/                  # Final output
â”œâ”€â”€ your_binary.py              # Recovered source (if successful)
â”œâ”€â”€ module.py
â”œâ”€â”€ your_binary.dis             # Disassembly (fallback)
â”œâ”€â”€ module.log                  # Per-file decompilation log
â””â”€â”€ ...
```

---

## ðŸ” Technical Notes

### Why Multiple Decompilers?

- **`pycdc`**: Best for modern Python (3.8+), handles complex control flow.
- **`uncompyle6`**: Mature, supports wide version range (2.7â€“3.13), but fragile with malformed headers.
- **Raw extraction**: Bypasses header entirelyâ€”critical for custom or stripped builds.

### Color-Coded Logging

- **ðŸŸ¢ `[+]`**: Success / Progress
- **ðŸŸ¡ `[~]`**: Partial success (e.g., disassembly only)
- **ðŸ”´ `[!]`**: Error / Warning

> ðŸ’¡ Colors require ANSI-compatible terminal (most Linux/macOS/WSL shells).

### Limitations

- **Encrypted binaries**: Not supported (requires `pyinstxtractor-ng` with key).
- **Obfuscated code**: May require manual analysis of `.dis` files.
- **Python 2.x**: Not tested; focus is on Python 3.6+.

---

## ðŸ“š References

1. **PyInstaller Extractor**[extremecoders-re/pyinstxtractor](https://github.com/extremecoders-re/pyinstxtractor)*GPLv3, supports PyInstaller 2.0â€“6.14.0*
2. **pycdc / pycdas**[zrax/pycdc](https://github.com/zrax/pycdc)*C++ bytecode decompiler and disassembler*
3. **uncompyle6**[rocky/python-uncompyle6](https://github.com/rocky/python-uncompyle6)*Python bytecode decompiler*
4. **Python `.pyc` Format**
   [PEP 552 â€“ Deterministic pycs](https://peps.python.org/pep-0552/)

---

## ðŸ“„ License

This project is licensed under the **GNU General Public License v3.0**.See [LICENSE](LICENSE) for details.

> **Note**: This toolkit is for **authorized reverse engineering**, security research, and educational purposes only. Use in compliance with local laws and ethical guidelines.
